<mat-card appearance="raised" class="map-data-catalogue">
  <mat-card-header class="map-data-catalogue__header">
    <h2 class="map-data-catalogue__header__title">Kartenkatalog</h2>
    <button class="map-data-catalogue__header__minimize-button" (click)="toggleMinimizeMapDataCatalogue()" mat-icon-button>
      <mat-icon [fontIcon]="isMinimized ? 'arrow_drop_down' : 'arrow_drop_up'"></mat-icon>
    </button>
  </mat-card-header>
  <div class="map-data-catalogue__content" [ngClass]="{'map-data-catalogue__content--hidden': isMinimized}">
    <div class="map-data-catalogue__content__filter">
      <input #filterInput class="map-data-catalogue__content__filter__input" placeholder="Karten und Layer filtern" type="text" />
      <mat-icon class="map-data-catalogue__content__filter__input-icon">search</mat-icon>
    </div>
    <loading-and-process-bar [loadingState]="this.catalogueLoadingState"></loading-and-process-bar>
    <mat-accordion
      *ngIf="this.catalogueLoadingState === 'loaded'"
      class="map-data-catalogue__content__items"
      displayMode="flat"
      multi="true"
    >
      <ng-container *ngIf="this.isAuthenticated">
        <mat-expansion-panel
          #favouriteExpansionPanel
          *ngIf="!(!!this.filterString && this.filteredFavourites.length === 0)"
          class="map-data-catalogue__content__items__item"
          [expanded]="(!!this.filterString && this.filteredFavourites.length <= this.autoOpenThreshold) || true"
          hideToggle="true"
        >
          <mat-expansion-panel-header class="map-data-catalogue__content__items__item__header">
            <map-data-item-header
              class="map-data-catalogue__content__items__item__header__item"
              [filterString]="filterString"
              [title]="'Favoriten'"
              [loadingState]="favouritesLoadingState"
              [isExpanded]="favouriteExpansionPanel.expanded"
              [numberOfItems]="filteredFavourites.length"
            ></map-data-item-header>
          </mat-expansion-panel-header>

          <!-- 'Favourite' content -->
          <p *ngIf="this.filteredFavourites.length === 0"><em>Noch keine Favoriten hinzugef√ºgt.</em></p>
          <ng-container *ngFor="let favourite of this.filteredFavourites">
            <map-data-item-favourite
              [title]="favourite.title"
              [filterString]="filterString"
              [loadingState]="favouritesLoadingState"
              (addEvent)="addFavouriteToMap(favourite)"
              (deleteEvent)="deleteFavourite(favourite)"
            ></map-data-item-favourite>
          </ng-container>
        </mat-expansion-panel>
      </ng-container>

      <ng-container *ngFor="let topic of topics; index as i; trackBy: trackByTopicTitle">
        <mat-expansion-panel
          #topicExpansionPanel
          class="map-data-catalogue__content__items__item"
          [expanded]="(!!this.filterString && topic.maps.length <= this.autoOpenThreshold) || i < 1"
          hideToggle="true"
        >
          <mat-expansion-panel-header class="map-data-catalogue__content__items__item__header">
            <map-data-item-header
              class="map-data-catalogue__content__items__item__header__item"
              [filterString]="filterString"
              [title]="topic.title"
              [isExpanded]="topicExpansionPanel.expanded"
              [numberOfItems]="topic.maps.length"
            ></map-data-item-header>
          </mat-expansion-panel-header>

          <!-- 'Topic' content -->
          <ng-template matExpansionPanelContent>
            <div class="map-data-catalogue__content__items__item__content">
              <ng-container *ngFor="let map of topic.maps; trackBy: trackByMapId">
                <map-data-item-map
                  class="map-data-catalogue__content__items__item__content__item"
                  [filterString]="filterString"
                  [imageUrl]="map.icon"
                  [layers]="map.layers"
                  [title]="map.title"
                  (addEvent)="addActiveMap(map)"
                  (addLayerEvent)="addActiveLayer(map, $event)"
                ></map-data-item-map>
              </ng-container>
            </div>
          </ng-template>
        </mat-expansion-panel>
      </ng-container>
    </mat-accordion>
    <p
      *ngIf="this.filterString && this.topics.length === 0 && this.filteredFavourites.length === 0"
      class="map-data-catalogue__content__filter-no-results mat-body-2"
    >
      Keine Resultate zu diesem Filter.
    </p>
  </div>
</mat-card>
