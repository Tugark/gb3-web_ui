<mat-card appearance="outlined" class="map-catalogue-widget">
  <mat-card-header class="map-catalogue__header">
    <div class="map-catalogue__header__title">
      <mat-card-title>Verf√ºgbare Karten nach Topic</mat-card-title>
    </div>
  </mat-card-header>
  <div class="map-catalogue__filter">
    <input class="map-catalogue__filter__input" type="text" (keyup)="this.filterCatalog($event.target)" />
    <mat-icon class="map-catalogue__filter__input-icon">search</mat-icon>
  </div>
  <loading-and-process-bar [loadingState]="this.loadingState"></loading-and-process-bar>
  <mat-accordion *ngIf="this.loadingState === 'loaded'" class="map-catalogue__content" multi="true" displayMode="flat">
    <ng-container *ngFor="let topic of topics; trackBy: trackByTopicTitle">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <p>{{ topic.title }}</p>
        </mat-expansion-panel-header>
        <!-- Expansion panel content -->
        <ng-template matExpansionPanelContent>
          <ng-container *ngFor="let map of topic.maps; trackBy: trackByMapId">
            <mat-expansion-panel hideToggle="true" #mapExpansionPanel>
              <mat-expansion-panel-header (click)="mapExpansionPanel.toggle()" class="map__header">
                <button mat-icon-button (click)="addActiveMap(map)" color="primary" data-test-id="add-active-map">
                  <mat-icon>add</mat-icon>
                </button>
                <button
                  mat-icon-button
                  *ngIf="!mapExpansionPanel.expanded"
                  (click)="mapExpansionPanel.open()"
                  data-test-id="show-layers-of-the-map"
                >
                  <mat-icon>arrow_right</mat-icon>
                </button>
                <button
                  mat-icon-button
                  *ngIf="mapExpansionPanel.expanded"
                  (click)="mapExpansionPanel.close()"
                  data-test-id="hide-layers-of-the-map"
                >
                  <mat-icon>arrow_drop_down</mat-icon>
                </button>
                <img class="map__header__image" [src]="map.icon" [alt]="map.title" />
                <p
                  class="map__header__title"
                  matTooltip="{{ map.title }}"
                  [innerHTML]="map.title | highlightSearchQuery : this.filterString"
                ></p>
              </mat-expansion-panel-header>
              <!-- Expansion panel content -->
              <ng-template matExpansionPanelContent>
                <ng-container *ngFor="let layer of map.layers">
                  <div class="layer" *ngIf="!layer.isHidden">
                    <mat-icon class="layer__icon">layers</mat-icon>
                    <p
                      class="layer__title"
                      matTooltip="{{ layer.title }}"
                      [innerHTML]="layer.title | highlightSearchQuery : this.filterString"
                    ></p>
                    <button mat-icon-button (click)="addActiveLayer(map, layer)"><mat-icon>add</mat-icon></button>
                  </div>
                </ng-container>
              </ng-template>
            </mat-expansion-panel>
          </ng-container>
        </ng-template>
      </mat-expansion-panel>
    </ng-container>
  </mat-accordion>
</mat-card>
