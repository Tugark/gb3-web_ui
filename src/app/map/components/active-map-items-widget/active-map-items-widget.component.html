<mat-card appearance="outlined" class="active-map-items-widget">
  <mat-card-header class="active-map-items__header">
    <div class="active-map-items__header__title">
      <mat-card-title>Aktive Karten/Layer</mat-card-title>
    </div>
    <button
      class="active-map-items__header__buttons"
      mat-raised-button
      color="warn"
      (click)="removeAllActiveMapItems()"
      [disabled]="activeMapItems.length === 0"
    >
      Clear
    </button>
    <button
      class="active-map-items__header__buttons"
      mat-raised-button
      (click)="this.toggleLegend()"
      [disabled]="activeMapItems.length === 0"
    >
      Legende
    </button>
  </mat-card-header>
  <mat-accordion class="active-map-items__content" multi="true" displayMode="flat" cdkDropList (cdkDropListDropped)="dropMapItem($event)">
    <div *ngFor="let activeMapItem of activeMapItems; trackBy: trackByMapItemId" [@slideInOut]>
      <mat-expansion-panel cdkDrag hideToggle="true" #activeMapItemExpansionPanel>
        <mat-expansion-panel-header (click)="activeMapItemExpansionPanel.toggle()" class="active-map-item">
          <div class="active-map-item__container">
            <mat-icon class="active-map-item__drag-handle" cdkDragHandle>drag_indicator</mat-icon>
            <button mat-icon-button *ngIf="!activeMapItemExpansionPanel.expanded" (click)="activeMapItemExpansionPanel.open()">
              <mat-icon>chevron_right</mat-icon>
            </button>
            <button mat-icon-button *ngIf="activeMapItemExpansionPanel.expanded" (click)="activeMapItemExpansionPanel.close()">
              <mat-icon>expand_more</mat-icon>
            </button>
            <button mat-icon-button (click)="toggleMapItemVisibility(activeMapItem)">
              <div class="active-map-item__image-container">
                <mat-icon class="active-map-item__image-container__image">image</mat-icon>
                <mat-icon
                  class="active-map-item__image-container__visibility"
                  [fontIcon]="activeMapItem.visible ? 'visibility' : 'visibility_off'"
                ></mat-icon>
              </div>
            </button>
            <p class="active-map-item__title" matTooltip="{{ activeMapItem.title }}">{{ activeMapItem.title }}</p>
            <button mat-icon-button (click)="removeActiveMapItem(activeMapItem)">
              <mat-icon>delete</mat-icon>
            </button>
            <div class="active-map-item__menu">
              <button mat-icon-button class="active-map-item__menu__handle" (click)="activeMapItemMenuTrigger.openMenu()">
                <mat-icon>more_horiz</mat-icon>
                <div #activeMapItemMenuTrigger="matMenuTrigger" [matMenuTriggerFor]="activeMapItemMenu"></div>
              </button>
              <mat-menu #activeMapItemMenu="matMenu">
                <!-- TODO: replace this placeholder -->
                <button mat-menu-item>Option 1</button>
                <!-- TODO: replace this placeholder -->
                <button mat-menu-item>Option 2</button>
              </mat-menu>
            </div>
            <mat-progress-bar
              *ngIf="activeMapItem.loadingState === 'loading'"
              class="active-map-item-updating-progress"
              mode="query"
            ></mat-progress-bar>
            <mat-progress-bar
              *ngIf="activeMapItem.loadingState === 'error'"
              class="active-map-item-updating-progress"
              color="warn"
              mode="determinate"
              value="100"
            ></mat-progress-bar>
            <mat-progress-bar
              *ngIf="activeMapItem.loadingState === 'loaded' && activeMapItem.viewProcessState === 'updating'"
              class="active-map-item-updating-progress"
              mode="buffer"
            ></mat-progress-bar>
          </div>
        </mat-expansion-panel-header>
        <!-- Expansion panel content -->
        <ng-template matExpansionPanelContent>
          <active-map-item [activeMapItem]="activeMapItem"></active-map-item>
        </ng-template>
      </mat-expansion-panel>
    </div>
  </mat-accordion>
</mat-card>
